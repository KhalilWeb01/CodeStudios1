<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Product | SUMWON</title>
  <link rel="stylesheet" href="style.css">
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">
  <style>
    .product-detail { max-width: 540px; margin: 0 auto; background: #fff; border-radius: 16px; box-shadow: 0 2px 16px rgba(0,0,0,0.07); padding: 0 0 1.5em 0; }
    .product-gallery { width: 100%; position: relative; text-align: center; }
    .product-gallery img { width: 100%; max-width: 420px; border-radius: 0 0 16px 16px; }
    .product-gallery-dots { display: flex; justify-content: center; gap: 7px; margin: 0.5em 0; }
    .product-gallery-dot { width: 8px; height: 8px; border-radius: 50%; background: #bbb; border: none; }
    .product-gallery-dot.active { background: #222; }
    .product-info { padding: 1.1em 1.2em 0 1.2em; }
    .product-price { display: flex; align-items: center; gap: 0.7em; font-size: 1.3em; margin-bottom: 0.2em; }
    .current-price { color: #e53935; font-weight: bold; font-size: 1.3em; }
    .old-price { color: #888; text-decoration: line-through; font-size: 1em; }
    .discount { color: #e53935; background: #fff0f0; border: 1px solid #e53935; border-radius: 5px; font-size: 0.95em; padding: 2px 7px; font-weight: 600; }
    .product-title { font-size: 1.15em; font-weight: 700; margin: 0.2em 0 0.3em 0; }
    .product-rating { color: #ffb400; font-size: 1.1em; margin-right: 0.3em; }
    .product-reviews { color: #888; font-size: 0.98em; margin-left: 0.2em; }
    .product-swatches { display: flex; flex-wrap: wrap; gap: 0.5em; margin: 0.7em 0 1em 0; }
    .swatch { position: relative; width: 32px; height: 32px; border-radius: 50%; border: 2px solid #eee; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: border 0.2s; }
    .swatch.selected { border: 2.5px solid #e53935; }
    .swatch-discount { position: absolute; top: -13px; left: 50%; transform: translateX(-50%); background: #fff; color: #e53935; border: 1px solid #e53935; border-radius: 4px; font-size: 0.8em; padding: 0 4px; font-weight: 600; }
    .swatch-inner { width: 22px; height: 22px; border-radius: 50%; border: 1.5px solid #ccc; }
    .product-options { margin-bottom: 1.1em; }
    .product-sizes { display: flex; flex-wrap: wrap; gap: 0.5em; margin: 0.7em 0 1.2em 0; }
    .size-btn { padding: 0.5em 1.2em; border-radius: 7px; border: 1.5px solid #eee; background: #fafafa; font-size: 1em; font-weight: 600; cursor: pointer; transition: border 0.2s, background 0.2s; }
    .size-btn.selected { border: 2px solid #222; background: #e6e6e6; }
    .size-btn[disabled] { color: #aaa; border: 1.5px dashed #ddd; background: #f5f5f5; cursor: not-allowed; }
    .add-to-cart-bar { position: fixed; left: 0; right: 0; bottom: 0; background: #18191a; color: #fff; z-index: 100; display: flex; align-items: center; justify-content: center; padding: 1em 0.5em; box-shadow: 0 -2px 16px rgba(0,0,0,0.10); }
    .add-to-cart-bar .add-to-cart-btn { background: #fff; color: #18191a; font-weight: 700; border: none; border-radius: 8px; padding: 0.7em 2.2em; font-size: 1.1em; cursor: pointer; margin-left: 1em; }
    .signup-offer { position: fixed; left: 50%; bottom: 70px; transform: translateX(-50%); background: #fff; color: #222; border-radius: 12px; box-shadow: 0 2px 16px rgba(0,0,0,0.13); padding: 1em 1.5em; z-index: 101; display: flex; align-items: center; gap: 1em; }
    .signup-offer .close-signup { background: none; border: none; font-size: 1.5em; color: #888; cursor: pointer; margin-left: 1em; }
    @media (max-width: 600px) {
      .product-detail { border-radius: 0; box-shadow: none; }
      .product-info { padding: 0.7em 0.5em 0 0.5em; }
      .add-to-cart-bar { font-size: 0.98em; padding: 0.7em 0.2em; }
      .signup-offer { padding: 0.7em 0.7em; font-size: 0.98em; }
    }
  </style>
</head>
<body>
  <header>
    <nav class="navbar-flex">
            <button class="menu-btn" id="openSidebar" aria-label="Open menu">
                <span></span><span></span><span></span>
            </button>
            <!-- Mobile centered logo -->
            <a href="index.html" class="mobile-logo" aria-label="Home">
              <span class="logo-icon" aria-hidden="true">
                <svg width="28" height="28" viewBox="0 0 64 64">
                  <path class="logo-arc-top" d="M 14 29 a 20 20 0 1 1 40 0" stroke="#fff" stroke-width="6" fill="none" stroke-linecap="butt" />
                  <path class="logo-arc-bottom" d="M 14 35 a 20.5 21 0 0 0  40 0" stroke="#fff" stroke-width="6" fill="none" stroke-linecap="butt" />
                  <line class="logo-vert" x1="32" y1="12" x2="32" y2="52" stroke="#fff" stroke-width="6" stroke-linecap="butt" />
                  <line class="logo-horiz" x1="32" y1="32" x2="52" y2="32" stroke="#fff" stroke-width="6" stroke-linecap="butt" />
                </svg>
              </span>
              <span class="mobile-brand-text">Code Studios</span>
            </a>

            <!-- Brand logo + name (desktop like in pages/tshirts.html) -->
            <div class="brand-logo-wrap brand-logo-main" onclick="location.href='index.html'" style="cursor:pointer;">
              <div class="logo">
                <div class="logo-icon">
                  <svg width="64" height="64" viewBox="0 0 64 64">
                    <path class="logo-arc-top" d="M 14 29 a 20 20 0 1 1 40 0" stroke="#fff" stroke-width="6" fill="none" stroke-linecap="butt" />
                    <path class="logo-arc-bottom" d="M 14 35 a 20.5 21 0 0 0  40 0" stroke="#fff" stroke-width="6" fill="none" stroke-linecap="butt" />
                    <line class="logo-vert" x1="32" y1="12" x2="32" y2="52" stroke="#fff" stroke-width="6" stroke-linecap="butt" />
                    <line class="logo-horiz" x1="32" y1="32" x2="52" y2="32" stroke="#fff" stroke-width="6" stroke-linecap="butt" />
                  </svg>
                </div>
              </div>
              <span class="brand-name">Code Studios</span>
            </div>

            <!-- Desktop Navigation Menu -->
            <nav class="desktop-nav">
                <ul class="nav-links">
                    <li><a href="index.html">Home</a></li>
                    <li class="nav-dropdown">
                        <button class="nav-dropdown-btn" id="categoriesDropdown">
                            Categories
                            <span class="dropdown-arrow">‚ñº</span>
                        </button>
                        <div class="nav-dropdown-content" id="categoriesDropdownContent">
                            <a href="pages/tshirts.html">T-shirts</a>
                            <a href="pages/shirts.html">Shirts</a>
                            <a href="pages/trousers.html">Trousers</a>
                            <a href="pages/shorts.html">Shorts</a>
                            <a href="pages/shoes.html">Shoes</a>
                        </div>
                    </li>
                    <li><a href="dashboard/dash.html">Dashboard</a></li>
                    <li><a href="#" onclick="showCart()">Cart</a></li>
                    <li><a href="pages/profile.html">Profile</a></li>
                    <li>
                        <button id="desktopThemeToggle" class="theme-toggle-btn">
                            üåô Dark Mode
                        </button>
                    </li>
                </ul>
            </nav>

            <div class="search-box-wrap" style="position:relative;display:inline-block;">
              <button class="search-btn" aria-label="Search">
                <svg class="search-icon" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="#222" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round">
                  <circle cx="11" cy="11" r="7" />
                  <line x1="18" y1="18" x2="15.5" y2="15.5" />
                </svg>
              </button>
              <input type="text" class="search-input-box" id="searchInputBox" placeholder="Search products..." style="display:none;">
              <div class="search-suggestions" id="searchSuggestions" style="display:none;"></div>
            </div>
        </nav>
  </header>
  <aside class="sidebar" id="sidebar">
    <button class="close-btn" id="closeSidebar" aria-label="Close menu">&times;</button>
    <ul class="sidebar-links">
      <li><a href="index.html">Home</a></li>
      <li class="sidebar-dropdown">
        <button class="sidebar-dropdown-btn" id="sidebarCategoriesDropdown">
          Categories
          <span class="dropdown-arrow">‚ñº</span>
        </button>
        <div class="sidebar-dropdown-content" id="sidebarCategoriesDropdownContent">
          <a href="pages/tshirts.html">T-shirts</a>
          <a href="pages/shirts.html">Shirts</a>
          <a href="pages/trousers.html">Trousers</a>
          <a href="pages/shorts.html">Shorts</a>
          <a href="pages/shoes.html">Shoes</a>
        </div>
      </li>
      <li><a href="pages/dashboard/dash.html">Dashboard</a></li>
      <li><a href="#" id="openCartModal">Cart</a></li>
      <li><a href="pages/profile.html">Profile</a></li>
      <li class="theme-toggle">
        <button id="themeToggle" style="background:none;border:none;color:inherit;font-size:1.2em;padding:0.5em 1em;display:block;width:100%;text-align:left;cursor:pointer;">
          üåô Dark Mode
        </button>
      </li>
    </ul>
  </aside>
  <main>
    <section class="product-detail" id="productDetail">
      <div class="loading">Loading...</div>
    </section>
    <div class="signup-offer" id="signupOffer">
      <span>üéÅ <b>SIGN UP FOR 15% OFF</b></span>
      <button class="close-signup" onclick="document.getElementById('signupOffer').style.display='none'">&times;</button>
    </div>
    <div class="add-to-cart-bar" id="addToCartBar" style="display:none">
      <span id="cartBarPrice"></span>
      <button class="add-to-cart-btn">ADD TO CART</button>
    </div>
  </main>
  <footer>
    <section class="subscribe">
      <h3>Join our mailing list</h3>
      <form>
        <input type="email" placeholder="Your Email" required>
        <button type="submit">Subscribe</button>
      </form>
      <p class="terms">By continuing, you agree to our <a href="#">Terms Of Use</a> and <a href="#">Privacy & Cookie Policy</a>.</p>
    </section>
    <ul class="footer-links">
      <li><a href="#">Shipping Info</a></li>
      <li><a href="#">Terms & Conditions</a></li>
      <li><a href="#">Privacy Policy</a></li>
      <li><a href="#">Return Policy</a></li>
      <li><a href="#">Contact Us</a></li>
    </ul>
    <p>¬© 2025 Code Studios-ALL RIGHTS RESERVED</p>
  </footer>
  <!-- –ù–∏–∂–Ω—è—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è -->
  <nav class="bottom-nav">
    <a href="index.html" class="bottom-nav-link">
      <span class="bottom-nav-icon">
        <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="#222" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 12L12 3l9 9"/><path d="M9 21V9h6v12"/></svg>
      </span>
      <span class="bottom-nav-label">Home</span>
    </a>
    <a href="#" class="bottom-nav-link" onclick="showCart && showCart()">
      <span class="bottom-nav-icon">
        <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="#222" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round"><circle cx="9" cy="21" r="1"/><circle cx="20" cy="21" r="1"/><path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"/></svg>
        <span class="cart-badge" id="cartBadge">0</span>
      </span>
      <span class="bottom-nav-label">Cart</span>
    </a>
    <a href="pages/profile.html" class="bottom-nav-link">
      <span class="bottom-nav-icon">
        <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="#222" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="8" r="4"/><path d="M2 21v-2a4 4 0 0 1 4-4h12a4 4 0 0 1 4 4v2"/></svg>
      </span>
      <span class="bottom-nav-label">Me</span>
    </a>
  </nav>
  <script src="script.js"></script>
  <script>
    function getProducts() {
      const data = localStorage.getItem('products');
      if (!data) return [];
      return JSON.parse(data);
    }

    function generateProductId() {
      return 'prod_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
    }

    function migrateExistingProducts() {
      const products = getProducts();
      let needsUpdate = false;
      products.forEach(product => {
        if (!product.id) {
          product.id = generateProductId();
          needsUpdate = true;
        }
      });
      if (needsUpdate) {
        localStorage.setItem('products', JSON.stringify(products));
      }
    }

    function addDemoProducts() {
      const products = getProducts();
      if (products.length === 0) {
        const demoProducts = [
          {
            id: generateProductId(),
            name: "Classic White T-Shirt",
            price: 45.00,
            oldPrice: 65.00,
            description: "Premium cotton classic white t-shirt with comfortable fit.",
            colors: ["#ffffff", "#000000", "#808080"],
            quantity: 25,
            category: "tshirt",
            rating: 4.5,
            photos: ["https://images.unsplash.com/photo-1521572163474-6864f9cf17ab?auto=format&fit=crop&w=400&q=80"],
            sizes: ['S', 'M', 'L']
          },
          {
            id: generateProductId(),
            name: "Oversized Black Tee",
            price: 55.00,
            oldPrice: 75.00,
            description: "Trendy oversized black t-shirt perfect for casual wear.",
            colors: ["#000000", "#333333"],
            quantity: 18,
            category: "tshirt",
            rating: 4.8,
            photos: ["https://images.unsplash.com/photo-1503341504253-dff4815485f1?auto=format&fit=crop&w=400&q=80"],
            sizes: ['M', 'L']
          },
          {
            id: generateProductId(),
            name: "Striped Summer Tee",
            price: 35.00,
            description: "Lightweight striped t-shirt perfect for summer days.",
            colors: ["#0000ff", "#ff0000", "#00ff00"],
            quantity: 30,
            category: "tshirt",
            rating: 4.2,
            photos: ["https://images.unsplash.com/photo-1434389677669-e08b4cac3105?auto=format&fit=crop&w=400&q=80"],
            sizes: ['XS', 'S', 'M']
          },
          {
            id: generateProductId(),
            name: "Premium Cotton V-Neck",
            price: 65.00,
            oldPrice: 85.00,
            description: "High-quality cotton v-neck t-shirt with elegant design.",
            colors: ["#ffffff", "#000000", "#8B4513"],
            quantity: 15,
            category: "tshirt",
            rating: 4.7,
            photos: ["https://images.unsplash.com/photo-1581655353564-df123a1eb820?auto=format&fit=crop&w=400&q=80"],
            sizes: ['L', 'XL']
          }
        ];
        localStorage.setItem('products', JSON.stringify(demoProducts));
      }
    }

    function calcDiscount(price, oldPrice) {
      if (!oldPrice || !price) return null;
      return Math.round(100 - (price / oldPrice) * 100);
    }

    function loadProduct() {
      migrateExistingProducts(); // Ensure all products have IDs
      addDemoProducts(); // Add demo products if none exist
      
      const params = new URLSearchParams(window.location.search);
      const id = params.get('id');
      const detail = document.getElementById('productDetail');
      
      if (!id) {
        detail.innerHTML = '<div class="error">Product not found.</div>';
        return;
      }

      const products = getProducts();
      const product = products.find(p => p.id === id);
      
      if (!product) {
        // Try to fetch from backend API, then retry render
        fetch('api/products.php?id=' + encodeURIComponent(id))
          .then(r => r.ok ? r.json() : null)
          .then(p => {
            if (p && p.id) {
              try {
                const arr = getProducts();
                arr.push(p);
                localStorage.setItem('products', JSON.stringify(arr));
              } catch {}
              loadProduct();
            } else {
              detail.innerHTML = '<div class="error">Product not found.</div>';
            }
          })
          .catch(() => {
            detail.innerHTML = '<div class="error">Product not found.</div>';
          });
        return;
      }

      // –ì–∞–ª–µ—Ä–µ—è
      let gallery = '';
      if (product.photos && product.photos.length > 0) {
        gallery = `<div class='product-gallery'><img id='mainImg' src='${product.photos[0]}' alt='${product.name}' />`;
        if (product.photos.length > 1) {
          gallery += `<div class='product-gallery-dots'>`;
          for (let i = 0; i < product.photos.length; i++) {
            gallery += `<button class='product-gallery-dot' data-idx='${i}'${i===0?' active':''}></button>`;
          }
          gallery += `</div>`;
        }
        gallery += `</div>`;
      }

      // –¶–≤–µ—Ç–∞
      let swatches = '';
      if (product.colors && product.colors.length > 0) {
        swatches = `<div class='product-swatches'>`;
        for (let i = 0; i < product.colors.length; i++) {
          const color = product.colors[i];
          swatches += `<div class='swatch' data-color='${i}' title='Color ${i+1}'>
            <span class='swatch-inner' style='background:${color}'></span>
          </div>`;
        }
        swatches += `</div>`;
      }

      // –†–∞–∑–º–µ—Ä—ã (—Ç–æ–ª—å–∫–æ —Ç–µ, —á—Ç–æ —É–∫–∞–∑–∞–Ω—ã –≤ product.sizes)
      let sizes = '';
      if (product.sizes && product.sizes.length > 0) {
        sizes = `<div class='product-sizes'>`;
        for (let size of product.sizes) {
          const available = product.quantity > 0;
          sizes += `<button class='size-btn'${!available?' disabled':''}>${size}</button>`;
        }
        sizes += `</div>`;
      } else {
        sizes = `<div class='product-sizes'><span style='color:#888;'>No sizes specified</span></div>`;
      }

      // –†–µ–π—Ç–∏–Ω–≥ –∏ –æ—Ç–∑—ã–≤—ã
      let reviews = `<div style='margin:0.5em 0 1em 0;'>`;
      if (product.rating) {
        reviews += `<span class='product-rating'>${'‚òÖ'.repeat(Math.floor(product.rating))}${'‚òÜ'.repeat(5-Math.floor(product.rating))}</span> <span class='product-reviews'>${product.rating} RATING</span>`;
      } else {
        reviews += `<span class='product-rating'>‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</span> <span class='product-reviews'>NEW PRODUCT</span>`;
      }
      reviews += `</div>`;

      // –°–∫–∏–¥–∫–∞
      const discount = (product.oldPrice && product.price) ? calcDiscount(product.price, product.oldPrice) : null;

      // –ò—Ç–æ–≥–æ–≤–∞—è —Ä–∞–∑–º–µ—Ç–∫–∞
      detail.innerHTML = `
        ${gallery}
        <div class='product-info'>
          <div class='product-price'>
            <span class='current-price'>${product.price} AED</span>
            ${product.oldPrice ? `<span class='old-price'>${product.oldPrice} AED</span>` : ''}
            ${discount ? `<span class='discount'>-${discount}%</span>` : ''}
          </div>
          <div class='product-title'>${product.name}</div>
          ${reviews}
          ${product.colors && product.colors.length > 0 ? `<div class='product-options'><b>COLOR:</b> <span id='colorName'>Color 1</span></div>` : ''}
          ${swatches}
          <div class='product-options'><b>SIZE:</b></div>
          ${sizes}
          <div class='product-description'><p>${product.description || 'No description available.'}</p></div>
          <div style='margin-top:1em;color:#888;font-size:0.9em;'>Stock: ${product.quantity} units</div>
        </div>
        <div class="product-accordion" id="productAccordion">
          <div class="accordion-item">
            <button class="accordion-header" type="button">
              <span class="accordion-icon"> <svg width="22" height="22" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="6" width="18" height="12" rx="2"/><line x1="3" y1="10" x2="21" y2="10"/></svg> </span>
              <span class="accordion-title">DESCRIPTION</span>
              <span class="accordion-value">100% Polyester</span>
              <span class="accordion-arrow">&#9660;</span>
            </button>
            <div class="accordion-content">${product.description || 'No description available.'}</div>
          </div>
          <div class="accordion-item">
            <button class="accordion-header" type="button">
              <span class="accordion-icon"> <svg width="22" height="22" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="M12 8v4l3 3"/></svg> </span>
              <span class="accordion-title">SECURE PAYMENT</span>
              <span class="accordion-arrow">&#9660;</span>
            </button>
            <div class="accordion-content">All payments are processed securely. Your payment information is encrypted and protected.</div>
          </div>
          <div class="accordion-item">
            <button class="accordion-header" type="button">
              <span class="accordion-icon"> <svg width="22" height="22" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="1" y="7" width="20" height="13" rx="2"/><path d="M16 3h-1a2 2 0 0 0-2 2v2"/><circle cx="8.5" cy="14.5" r="1.5"/><circle cx="15.5" cy="14.5" r="1.5"/></svg> </span>
              <span class="accordion-title">SHIPPING INFO</span>
              <span class="accordion-arrow">&#9654;</span>
            </button>
            <div class="accordion-content">We offer worldwide shipping. Orders are processed within 1-2 business days and delivered within 5-10 business days depending on your location.</div>
          </div>
          <div class="accordion-item">
            <button class="accordion-header" type="button">
              <span class="accordion-icon"> <svg width="22" height="22" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="7" width="18" height="13" rx="2"/><path d="M8 7V5a4 4 0 0 1 8 0v2"/></svg> </span>
              <span class="accordion-title">RETURN POLICY</span>
              <span class="accordion-arrow">&#9654;</span>
            </button>
            <div class="accordion-content">You can return any item within 14 days of delivery for a full refund. Items must be unused and in original packaging.</div>
          </div>
        </div>
        <div class="product-reviews-block">
          <div class="reviews-header-row">
            <span class="reviews-title">REVIEWS <span class="reviews-count">(1082)</span></span>
            <a href="#" class="reviews-view-more">VIEW MORE <span class="reviews-arrow">&#8250;</span></a>
          </div>
          <div class="reviews-summary">
            <span class="reviews-average">4.8</span>
            <span class="reviews-stars">&#9733;&#9733;&#9733;&#9733;&#9733;</span>
          </div>
          <div class="review-item">
            <div class="review-row">
              <span class="review-author">F***A</span>
              <span class="review-date">2025/06/30</span>
            </div>
            <div class="review-stars">&#9733;&#9733;&#9733;&#9733;&#9733;</div>
            <div class="review-text">This is a great jumper. It's not super thick or warm but it's fine over another layer.</div>
            <div class="review-photos">
              <img src="https://images.unsplash.com/photo-1521572163474-6864f9cf17ab?auto=format&fit=crop&w=200&q=80" alt="review photo">
            </div>
          </div>
        </div>
        <div class="product-recommend-block" id="productRecommendBlock"></div>
      `;

      // –ì–∞–ª–µ—Ä–µ—è dots
      if (product.photos && product.photos.length > 1) {
        const mainImg = document.getElementById('mainImg');
        document.querySelectorAll('.product-gallery-dot').forEach(dot => {
          dot.addEventListener('click', function() {
            const idx = +this.getAttribute('data-idx');
            mainImg.src = product.photos[idx];
            document.querySelectorAll('.product-gallery-dot').forEach(d => d.classList.remove('active'));
            this.classList.add('active');
          });
        });
      }

      // Swatch –≤—ã–±–æ—Ä —Ü–≤–µ—Ç–∞
      if (product.colors && product.colors.length > 0) {
        let selectedColorIndex = 0;
        document.querySelectorAll('.swatch').forEach((sw, i) => {
          if (i === 0) sw.classList.add('selected');
          sw.addEventListener('click', function() {
            document.querySelectorAll('.swatch').forEach(s => s.classList.remove('selected'));
            this.classList.add('selected');
            selectedColorIndex = i;
            document.getElementById('colorName').textContent = `Color ${i+1}`;
          });
        });
      }

      // Size –≤—ã–±–æ—Ä
      let selectedSize = null;
      document.querySelectorAll('.size-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          if (this.disabled) return;
          document.querySelectorAll('.size-btn').forEach(b => b.classList.remove('selected'));
          this.classList.add('selected');
          selectedSize = this.textContent;
        });
      });

      // Add to cart bar
      const cartBar = document.getElementById('addToCartBar');
      const cartBarPrice = document.getElementById('cartBarPrice');
      cartBarPrice.textContent = `${product.price} AED`;
      cartBar.style.display = 'flex';
    }
    
    loadProduct();
    
    // Render recommendations
    function renderRecommendations(currentProduct) {
      const block = document.getElementById('productRecommendBlock');
      if (!block) return;
      const all = getProducts().filter(p => p.category === currentProduct.category && p.id !== currentProduct.id);
      if (all.length === 0) {
        block.innerHTML = '';
        return;
      }
      // Shuffle and pick up to 4
      const shuffled = all.sort(() => 0.5 - Math.random());
      const recs = shuffled.slice(0, 4);
      block.innerHTML = `
        <div class="recommend-title">YOU MAY ALSO LIKE</div>
        <div class="recommend-list">
          ${recs.map(product => {
            const discount = (product.oldPrice && product.price) ? Math.round(100 - (product.price / product.oldPrice) * 100) : null;
            return `
              <div class="recommend-card" onclick="window.location.href='product.html?id=${product.id}'">
                ${discount ? `<div class='recommend-discount'>-${discount}%</div>` : ''}
                <div class="recommend-img-wrap">
                  ${product.photos && product.photos[0] ? `<img src="${product.photos[0]}" alt="product">` : ''}
                  <button class="recommend-cart" onclick="event.stopPropagation();">&#128722;</button>
                </div>
                <div class="recommend-title-row">${product.name.length > 22 ? product.name.slice(0, 20) + '‚Ä¶' : product.name}</div>
                <div class="recommend-price-row">
                  <span class="recommend-price">${product.price} AED</span>
                  ${product.oldPrice ? `<span class="recommend-old-price">${product.oldPrice} AED</span>` : ''}
                  ${product.rating ? `<span class="recommend-rating">&#9733; ${product.rating}</span>` : ''}
                </div>
                <div class="recommend-colors">
                  ${(product.colors||[]).slice(0,3).map(c=>`<span class='recommend-color-dot' style='background:${c}'></span>`).join('')}
                </div>
              </div>
            `;
          }).join('')}
        </div>
      `;
    }

    // After loadProduct, call renderRecommendations
    const params = new URLSearchParams(window.location.search);
    const id = params.get('id');
    const products = getProducts();
    const currentProduct = products.find(p => p.id === id);
    if (currentProduct) renderRecommendations(currentProduct);

    // Accordion logic
    document.addEventListener('click', function(e) {
      if (e.target.closest('.accordion-header')) {
        const btn = e.target.closest('.accordion-header');
        const item = btn.parentElement;
        const content = item.querySelector('.accordion-content');
        const arrow = btn.querySelector('.accordion-arrow');
        const isOpen = item.classList.contains('open');
        document.querySelectorAll('.product-accordion .accordion-item').forEach(i => {
          i.classList.remove('open');
          i.querySelector('.accordion-content').style.maxHeight = null;
          i.querySelector('.accordion-arrow').innerHTML = '&#9660;';
        });
        if (!isOpen) {
          item.classList.add('open');
          content.style.maxHeight = content.scrollHeight + 'px';
          arrow.innerHTML = '&#9650;';
        }
      }
    });
    
    // Theme toggle functionality
    const themeToggle = document.getElementById('themeToggle');
    const body = document.body;
    
    function getTheme() {
      return localStorage.getItem('theme') || 'light';
    }
    
    function setTheme(theme) {
      localStorage.setItem('theme', theme);
      if (theme === 'dark') {
        body.classList.add('dark-theme');
        themeToggle.innerHTML = '‚òÄÔ∏è Light Mode';
      } else {
        body.classList.remove('dark-theme');
        themeToggle.innerHTML = 'üåô Dark Mode';
      }
    }
    
    // Initialize theme
    setTheme(getTheme());
    
    // Theme toggle event
    if (themeToggle) {
      themeToggle.addEventListener('click', function() {
        const currentTheme = getTheme();
        setTheme(currentTheme === 'light' ? 'dark' : 'light');
      });
    }
  </script>
  <style>
  .product-accordion {
    margin: 2em 0 1em 0;
    border-radius: 12px;
    background: #fafbfc;
    box-shadow: 0 2px 8px rgba(0,0,0,0.04);
    overflow: hidden;
  }
  .accordion-item + .accordion-item {
    border-top: 1px solid #eee;
  }
  .accordion-header {
    width: 100%;
    background: none;
    border: none;
    outline: none;
    display: flex;
    align-items: center;
    justify-content: flex-start;
    gap: 1em;
    font-size: 1.08em;
    font-weight: 600;
    color: #222;
    padding: 1.1em 1.2em;
    cursor: pointer;
    transition: background 0.2s;
  }
  .accordion-header:hover {
    background: #f0f4f8;
  }
  .accordion-icon {
    display: flex;
    align-items: center;
    color: #888;
    min-width: 28px;
    justify-content: center;
  }
  .accordion-title {
    flex: 1 1 auto;
    text-align: left;
    letter-spacing: 0.5px;
  }
  .accordion-value {
    color: #666;
    font-size: 0.98em;
    margin-right: 1em;
    font-weight: 400;
  }
  .accordion-arrow {
    font-size: 1.2em;
    color: #888;
    margin-left: 0.5em;
    transition: transform 0.2s;
  }
  .accordion-content {
    max-height: 0;
    overflow: hidden;
    background: #fff;
    color: #222;
    font-size: 1em;
    padding: 0 1.2em;
    transition: max-height 0.3s cubic-bezier(.4,1.2,.7,1.01);
    border-bottom-left-radius: 12px;
    border-bottom-right-radius: 12px;
  }
  .accordion-item.open .accordion-content {
    padding: 1em 1.2em 1.2em 1.2em;
    max-height: 300px;
  }
  .accordion-item.open .accordion-header {
    background: #f0f4f8;
  }
  /* Dark theme */
  .dark-theme .product-accordion {
    background: #23272b;
    box-shadow: 0 2px 8px rgba(0,0,0,0.18);
  }
  .dark-theme .accordion-header {
    color: #fff;
    background: none;
  }
  .dark-theme .accordion-header:hover,
  .dark-theme .accordion-item.open .accordion-header {
    background: #2a2d31;
  }
  .dark-theme .accordion-icon {
    color: #bbb;
  }
  .dark-theme .accordion-value {
    color: #aaa;
  }
  .dark-theme .accordion-arrow {
    color: #bbb;
  }
  .dark-theme .accordion-content {
    background: #23272b;
    color: #fff;
  }
  </style>
  <style>
  .product-reviews-block {
    margin: 2.5em 0 1.5em 0;
    background: #fff;
    border-radius: 12px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.04);
    padding: 1.5em 1.2em 1.2em 1.2em;
    max-width: 540px;
    margin-left: auto;
    margin-right: auto;
  }
  .reviews-header-row {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 1em;
  }
  .reviews-title {
    font-weight: 700;
    font-size: 1.1em;
    letter-spacing: 0.5px;
  }
  .reviews-count {
    color: #888;
    font-weight: 500;
    font-size: 0.98em;
    margin-left: 2px;
  }
  .reviews-view-more {
    color: #222;
    font-size: 1em;
    text-decoration: none;
    font-weight: 500;
    letter-spacing: 0.5px;
    display: flex;
    align-items: center;
    gap: 2px;
    transition: color 0.2s;
  }
  .reviews-view-more:hover {
    color: #007aff;
  }
  .reviews-arrow {
    font-size: 1.2em;
    margin-left: 2px;
  }
  .reviews-summary {
    display: flex;
    align-items: center;
    gap: 0.7em;
    font-size: 1.5em;
    font-weight: 700;
    margin-bottom: 1.2em;
  }
  .reviews-average {
    font-size: 2.2em;
    color: #e53935;
    font-weight: 700;
    margin-right: 0.2em;
  }
  .reviews-stars {
    color: #ffb400;
    font-size: 1.5em;
    letter-spacing: 2px;
  }
  .review-item {
    background: #fafbfc;
    border-radius: 10px;
    padding: 1em 1em 1.2em 1em;
    margin-bottom: 0.5em;
    box-shadow: 0 1px 4px rgba(0,0,0,0.03);
  }
  .review-row {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 0.2em;
  }
  .review-author {
    font-weight: 700;
    font-size: 1.05em;
    letter-spacing: 1px;
  }
  .review-date {
    color: #888;
    font-size: 0.98em;
    font-weight: 500;
  }
  .review-stars {
    color: #ffb400;
    font-size: 1.1em;
    margin-bottom: 0.3em;
  }
  .review-text {
    font-size: 1em;
    color: #222;
    margin-bottom: 0.7em;
    margin-top: 0.2em;
  }
  .review-photos {
    display: flex;
    gap: 0.7em;
  }
  .review-photos img {
    width: 90px;
    height: 90px;
    object-fit: cover;
    border-radius: 8px;
    border: 1.5px solid #eee;
    background: #fff;
  }
  /* Dark theme */
  .dark-theme .product-reviews-block {
    background: #23272b;
    color: #fff;
    box-shadow: 0 2px 8px rgba(0,0,0,0.18);
  }
  .dark-theme .reviews-title {
    color: #fff;
  }
  .dark-theme .reviews-count {
    color: #aaa;
  }
  .dark-theme .reviews-view-more {
    color: #fff;
  }
  .dark-theme .reviews-view-more:hover {
    color: #8ec5fc;
  }
  .dark-theme .reviews-summary {
    color: #fff;
  }
  .dark-theme .reviews-average {
    color: #ffb400;
  }
  .dark-theme .review-item {
    background: #2a2d31;
    color: #fff;
    box-shadow: 0 1px 4px rgba(0,0,0,0.10);
  }
  .dark-theme .review-author {
    color: #fff;
  }
  .dark-theme .review-date {
    color: #bbb;
  }
  .dark-theme .review-stars {
    color: #ffe082;
  }
  .dark-theme .review-text {
    color: #fff;
  }
  .dark-theme .review-photos img {
    background: #23272b;
    border-color: #444;
  }
  </style>
  <style>
  .recommend-title {
    font-size: 1.1em;
    font-weight: 700;
    margin-bottom: 1em;
    color: #222;
    letter-spacing: 0.5px;
  }
  .recommend-list {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
    gap: 1em;
  }
  .recommend-card {
    position: relative;
    background: #fafbfc;
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 2px 8px rgba(0,0,0,0.04);
    cursor: pointer;
    transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
    border: 1px solid #eee;
  }
  .recommend-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.08);
  }
  .recommend-discount {
    position: absolute;
    top: 10px;
    right: 10px;
    background: #e53935;
    color: #fff;
    padding: 4px 8px;
    border-radius: 8px;
    font-size: 0.8em;
    font-weight: 600;
    z-index: 1;
  }
  .recommend-img-wrap {
    position: relative;
    width: 100%;
    height: 120px;
    overflow: hidden;
  }
  .recommend-img-wrap img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }
  .recommend-cart {
    position: absolute;
    top: 10px;
    left: 10px;
    background: #fff;
    color: #222;
    border: none;
    border-radius: 50%;
    width: 30px;
    height: 30px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.1em;
    cursor: pointer;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    z-index: 2;
  }
  .recommend-title-row {
    padding: 0.8em 1em;
    font-size: 0.95em;
    font-weight: 600;
    color: #222;
    text-align: left;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
  }
  .recommend-price-row {
    padding: 0 1em 0.8em 1em;
    display: flex;
    align-items: baseline;
    gap: 0.5em;
    font-size: 1.1em;
    font-weight: 700;
    color: #e53935;
  }
  .recommend-price {
    color: #e53935;
  }
  .recommend-old-price {
    color: #888;
    text-decoration: line-through;
    font-size: 0.9em;
  }
  .recommend-rating {
    font-size: 0.9em;
    color: #ffb400;
    font-weight: 600;
  }
  .recommend-colors {
    padding: 0 1em 0.8em 1em;
    display: flex;
    gap: 0.4em;
    justify-content: flex-start;
  }
  .recommend-color-dot {
    width: 10px;
    height: 10px;
    border-radius: 50%;
    border: 1px solid #eee;
    background: #fff;
    box-shadow: 0 1px 4px rgba(0,0,0,0.05);
  }
  /* Dark theme */
  .dark-theme .recommend-card {
    background: #2a2d31;
    border: 1px solid #444;
    box-shadow: 0 2px 8px rgba(0,0,0,0.18);
  }
  .dark-theme .recommend-card:hover {
    box-shadow: 0 4px 12px rgba(0,0,0,0.25);
  }
  .dark-theme .recommend-discount {
    background: #e53935;
    color: #fff;
  }
  .dark-theme .recommend-title-row {
    color: #fff;
  }
  .dark-theme .recommend-price-row {
    color: #ffb400;
  }
  .dark-theme .recommend-price {
    color: #ffb400;
  }
  .dark-theme .recommend-old-price {
    color: #aaa;
  }
  .dark-theme .recommend-rating {
    color: #ffe082;
  }
  .dark-theme .recommend-colors .recommend-color-dot {
    border-color: #444;
    background: #2a2d31;
  }
  </style>
  <style>
    .bottom-nav {
      position: fixed;
      left: 0;
      right: 0;
      bottom: 0;
      background: #fff;
      border-top: 1.5px solid #eee;
      display: flex;
      justify-content: space-around;
      align-items: center;
      height: 58px;
      z-index: 1002;
      box-shadow: 0 -2px 12px rgba(0,0,0,0.04);
    }
    .bottom-nav-link {
      flex: 1 1 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-decoration: none;
      color: #222;
      font-family: 'Montserrat', Arial, sans-serif;
      font-size: 1em;
      font-weight: 500;
      padding: 0 2px;
      transition: color 0.18s;
      position: relative;
    }
    .bottom-nav-link:active,
    .bottom-nav-link:focus {
      color: #4a90e2;
    }
    .bottom-nav-icon {
      font-size: 1.45em;
      margin-bottom: 2px;
      display: block;
      position: relative;
    }
    .bottom-nav-label {
      font-size: 1em;
      font-family: 'Montserrat', Arial, sans-serif;
      margin-top: 2px;
      letter-spacing: 0.2px;
    }
    .cart-badge {
      position: absolute;
      top: -6px;
      right: -10px;
      background: #e74c3c;
      color: #fff;
      border-radius: 50%;
      width: 18px;
      height: 18px;
      font-size: 11px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      z-index: 1;
      border: 2px solid #fff;
      box-shadow: 0 2px 6px rgba(0,0,0,0.10);
    }
  </style>
</body>
</html> 